{% extends 'base.html' %}
{% load static %}

{% block head %}
    <title>{{ detailed_film.title }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Neuton:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
{% endblock %}

{% block body %}
    <div class="container" style="margin-top: 200px">
        <div class="row">
            <div class="col-md-3">
                <img src="{{ detailed_film.poster.url }}" style="max-width: 360px" alt="">
            </div>
            <div class=" col-md-6" style="margin-left: 130px">
                <p>{{ detailed_film.title }}</p>
                <p>{{ detailed_film.body }}</p>
                <div class="inline-genres">
                    {% for genre in genres %}
                        <a class="btn-sm mr-2 btn-secondary"
                           href="{% url 'genre_detail' id=genre.id %}"> {{ genre.name }}</a>
                    {% endfor %}
                </div>
                <br> <br>
                <div class="inline-buttons">
                    {% if user.is_authenticated %}
                        <div class="watched-btn" style="display: inline">
                            <a href="#" style="margin-right: 20px"><i class="fas fa-eye fa-3x"></i></a>
                        </div>
                        <div class="like-btn" style="display: inline">
                            <a href="#" style="margin-right: 20px"><i class="fas fa-heart fa-3x"></i></a>
                        </div>
                        <div class="watchlist-btn" style="display: inline">

                            <a href="#" id="watchlist"
                                    {% if added_watchlist %}
                               style="color: #5fdde5"
                                    {% else %}
                               style="color: #726f6f"
                                    {% endif %}
                               onclick="WatchLater({{ detailed_film.id }});"><i
                                    class="fas fa-plus fa-3x"></i></a>


                        </div>



                    {% endif %}
                </div>
            </div>
        </div>
    </div>




    </div>

    <br> <br> <br>
    {% if film_reviews %}
        <ul class="film-review" style="padding-right: 40px;
}">
            <h4>Reviews</h4>
            <br>
            <div class="row">
                {% for review in film_reviews %}

                    <div class="col-md-4">
                        <div class="row no-gutters border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
                            <div class="col p-4 d-flex flex-column position-static" style="background-color: #fcf1fff7">
                                <div class="d-inline-block mb-2"> reviewed by
                                    <strong><i>{{ review.author }}</i></strong></div>
                                <p>‚≠ê {{ review.rating }}</p>
                                <p class="card-text mb-auto">{{ review.body|truncatechars:50 }}</p>
                                <a href="{% url 'profile:detail' id=review.id %}">continue reading</a>
                                <br>
                                <div class="mb-1 text-muted">{{ review.date }}</div>
                            </div>
                        </div>
                    </div>

                {% endfor %}
            </div>
        </ul>
    {% endif %}
    <br>

    <script>
        function WatchLater(film_id) {
            console.log("ipek");
            $.ajax({
                type: "POST",
                url: "{% url 'profile:watchLaterAjax' %}",
                data: {
                    film_id: film_id,
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
                },
                datatype: 'json',
                success: function (data) {
                    if (data['success']) {
                        console.log("success");
                        $("#watchlist").css('color', '#5fdde5')


                    } else {
                        $("#watchlist").css('color', '#726f6f')


                    }


                }
            });
        }


        $("#form-like").on('submit', function (event) {

            event.preventDefault();
            event.stopPropagation();
            var film_id = '{{ detailed_film.id }}';
            $.ajax({
                type: "POST",
                url: "{% url 'profile:likeAjax' %}",
                data: {
                    film_id: film_id,
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
                },
                datatype: 'json',
                success: function (data) {
                    if (data['success']) {
                        $("#btn-liked").remove()
                        $('#btn-unliked').remove()
                        $('#form-like').append("<button id=\"btn-liked\" class=\"btn btn-danger\" data-hover=\"Unlike\"><span>Liked</span></button>")


                    } else {
                        $("#btn-unliked").remove()
                        $('#btn-liked').remove()
                        $('#form-like').append("<button id=\"btn-unliked\" class=\"btn btn-secondary\">Like</button>")


                    }

                }
            });
        });
    </script>

{% endblock %}
}